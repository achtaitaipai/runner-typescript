(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALgAAADYCAYAAABYxymdAAAAAXNSR0IArs4c6QAAC4NJREFUeF7tnUFyFckORf1YgWHEkA0RsANGBGsCj9gBBMtgQLADVkCzAtzRkw5XOqKuryVlqsrnT1Opyjw6T0+viP6+XPG/UxN4/ubmNvOC/3x9f8nMV53rUIethnHG/Ah+xqpyp/8JIDgynJoAgk8u71MHXo07m686b/eZfPoMnl2A7oCVINnr2XzV+brzR3BVwYOtI/i2YAh+MIHVcRF8suAAV0rG1mfzVaftNrKUd/DZBegGWAkRXZ/NV523G38EVxVrvo7g+wVC8OYCq+Mh+GTBAa6UjK1346tus3pkSe/g3QqwGrASwF3vxledfzV/BFcVaraO4F5BENzjtTwawb0ShAUHuAfcjZ7N9/fn19YRX7z7ZsXPHlkQ3CrP/GAEjzFH8Bi/8t0IHkOM4DF+5bsRPIbYFhzgMeDu7mre7sytzq9m8vYzeDXwEaBbAAV4zD8buBJkXK/m7fJV51f8Z/Omgzf/r8QRXH2k9tcRHMFjBg276eAC59m/Ml2b6OAusW18uw6O4NsCITiC7xLo9pXplgvBXWJ08A2B2b/q3XIhuEsMwVsLXi109DWs0k19Y85+TcsM3uwtCoKrj5C3juAI7hkjoungvCbcJUAHT/28XckODvBc4Cpbd96X65fqA6quOPU3EIIP5Vj9VgXBrc+HDEZwBJeS3A2gg1u47gfP/pfM2a+tFB46uCLkrR++gx+to6jydBNc8R3v8/zNjbqitR4dGRGcEWVXOAS3Po862B1RVAHcjhLtGPqG+xF08C2faD3o4HRwOni0Kzn7VQdXHbv7TKhYzO7g43lG/oq3+w2p7h9dHzv+4Tq4Ao7gMUUQPMZP7qaD5/5lYgl8CEBwl5gZj+AIbiqzCW8/opx9JlTFWz2Dq/Mdbb3dDI7gazv40QRW50VwRSi47r7HpYMHgQ/bETyX571sCF4MWKRvL/haPPlPV8LTwXOZI3guT5kNwSWi1AAET8WpkyG4ZpQZgeCZNB+QC8EfACkxBMETYT4kFYI/hNLjYw73Dz2Pv2rPnQheWxcEr+UrsyO4RBQKQPAQvvhmBI8z3MuA4LV872VXQqvjnP29eJSP4sePTEUouB4tIILHCoDgMX5yN4LvI4ryUQVAcEUouB4tIB08VgAp+Jge4DHg7u6z8Y5+4F1+CD4Qm10AVTAEV4T21xEcwWMGmbtnNxAER3BT0Vg4gsf42btnA3cPyIjiEtvGP/kOjuAxgdzds3kjeLO/0XP2t1YI7raEYPxs4O5xGVFcYowoGwLdBe/W0X/8+mQZ9+rnd3tKsB4ggu2H01Ey8fu5VvNHcL9mS3fQwT38CO7xWh6N4F4JTi84M6EnRHX0OLLcXv7uPvJy+8w6kpuvW8OwZ3AEt/woD0bwfcQIXq5g7QMQHME3BFa/tsrWHcGLBVcjizvDKQHcfN1mQnW/6Pr124+3ezmyZ/A/Xz6Ep4DonXfvm52cjpJN1MuH4Fte6Z8+BPeEzI5GcATPdqpVPgQvFnysNsBr/Vd8x6dnz+Bj/m4zefqIguC1Qrt8Eby4HqrDZHeUbh2kGO+V4ovgxRVQBUDwWAEUXwSP8ZW7VQEQXCLcBCie1TPx6ud7tK6umMFdYovjVwu2+vkufgR3iS2OXy3Y6ue7+BHcJbY4frVgq5/v4k8XvBqAyn+2tyjqvtUztxJKnW91PRBcVXDxuhIIwfcLhOCLBVaPR3BFCMFjhBbvRvBYAaZ38OhMpgoezR/DGd+t7rd6JFE3VOefXR8EVxWbvK4EQXCvIAju8SqPRvBcxAieyzOcDcHDCDcJEDyXp53t6EKPF3bvUz1yIbitZO4GV4jZP9Lc27r3QfCBgALYXYBox+t+P1Uf9YHJvh8dXBEvXneFyBYg+3rufU7XwaMXcgEeXYju51cfkNX1mt7BEXxLQAmA4OojtL+O4DF+4d0IvkWY/YFG8LCisQQIjuAbAkqI6AgU05Xd3QjQwbtVhPOkEkDwVJwk60YAwbtVhPOkEkgXPPV0JAsTyP6zg0f7/1tH8LBCvRMgeO/6cLogAQQPAmR7bwIIPrk+Tx14Ne5svuq83Wfy6TN4dgG6A1aCZK9n81Xn684fwVUFD7aO4NuCIfjBBFbHRfDJggNcKRlbn81XnbbbyFLewWcXoBtgJUR0fTZfdd5u/BFcVaz5OoLvFwjBmwusjofgkwUHuFIytt6Nr7rN6pElvYN3K8BqwEoAd70bX3X+1fwRXFWo2TqCewVBcI/X8mgE90oQFhzgHnA3ejbf359fW0d88e6bFT97ZEFwqzzzgxE8xhzBY/zKdyN4DDGCx/iV70bwGGJbcIDHgLu7q3m7M7c6v5rJ28/g1cBHgG4BFOAx/2zgSpBxvZq3y1edX/GfzZsO/vW9zUAVOXMdwWM07eJWA6eDbwlU86aDD8YBPNZR3N3wdolt49t18LN3FLdcCO4SQ/ANgdk/etxyIbhLDMER/A6Bs39jMqI0e4tS3bGjP+JVP1WvCWe/pkVwBFfOWusILnCd/StT2UIHV4S8dTo4HdwzRkQfroPTUVLrL5N15325frl7h+dvbuQd7wZUv8WSHbw7cEWzW0dR5+3OG8FVBZvN4LN/1Ss8CK4Ieet08IFX9VemKg+CK0Le+uEFP9pXpipPN8EV3/E+7gyueEQbDoLTwXcdQ3D1ETTX3ffgqgBuR4l2DPO698Lp4Fsk0XrQwengdPBoV3L2qw6uOnb3mVCxmN3Bx/OM/BVv9xtS3T+6Pnb8w3VwBRzBY4ogeIyf3E0Hv7mVkAoDELwQ7n+pERzBI4q1H1HOPhOq4q2ewdX5jrbebgZH8LUd/GgCq/MiuCIUXHff49LBg8CH7Qiey/NeNgQvBizStxd8LZ78pyvh6eC5zBE8l6fMhuASUWoAgqfi1MkQXDPKjEDwTJoPyIXgD4CUGILgiTAfkgrBH0Lp8TGH+4eex1+1504Er60LgtfyldkRXCIKBSB4CF98M4LHGe5lQPBavveyK6HVcc7+XjzKR/HjR6YiFFyPFhDBYwVA8Bg/uRvB9xFF+agCILgiFFyPFpAOHiuAFHxMD/AYcHf32XhHP/AuPwQfiM0ugCoYgitC++sIjuAxg8zdsxsIgiO4qWgsHMFj/Ozds4G7B2REcYlt4598B0fwmEDu7tm8EbzZnzA5+1srBHdbQjB+NnD3uIwoLjFGlA2B7oJ36+g/fn2yjHv187s9JVgPEMH2w+komfj9XKv5I7hfs6U76OAefgT3eC2PRnCvBKcXnJnQE6I62h1Zbi9/d490uX0WOnK3hmHP4Ageqn/6ZgTfR4rg6crNTYjgCL4hsPq1Vbb+CF4suBpZsmc+N1+3mTBbcMV/XHf5qfN25xseURTgbKBuvu4FUAK566qju/zU87vzRXBVwYOtI/i2YAh+MIHVcRG8WPCxANdvP+7+1TD3vav6iv3z5UP6h1ZJVbmu+Kn7jsIrfqoe3UeSsRblMqgCKaDujyRV8EoZK3Irfuq+CF5RlTs5VYEQfL8Aih+CT35NyIiS2zEQPMaTESXGr3y3Erz8AMMD1DfG7POo5yG4IrR4HcFjBUDwGL/y3QgeQ4zgMX7luxE8hjhdcLcg7kyn8rv5Yvjm71b3d0808lL5j8YXwV0jFscrAd3jIbhJzC2A2xFUfjefeb3l4er+7gER3CTmFsAVUuV385nXWx6u7u8eEMFNYqoAUQGr85vXXR6ezSM732pA02dwBM8tebaQ2flyb+tnQ3CfWasd2UJm51sNC8FXVyD4/Gwhs/MFrxfejuBhhOdKoAQfbxsdOavpIXg14YPlR3BRMAUo+omvzn8wH9OPq/jSwcV/oobg6U6mJkTwYAePdoCzFSDVzoRkZ+M7fQZH8AQLC1MgOB28UK/1qREcwddbWHgCBEfwQr1InU2AGTybKPlaEUDwVuXgMNkEEDybKPlaEfgXABelAG+niUUAAAAASUVORK5CYII=",C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAA30lEQVRIS9WVyRHDIAxFTSfuIKf0X0BO6SCdJKBIGgGSEF5mbA4+sDz+14LTsmF8Hs/v+n4l7ag66d1RYGX9FsAitHM4ZZnsouWLARV1+xQeCpQwET+qrioPoaQY6vYDczEPm6NTqLUVzlkN5Fs+C6iVBPSwMVhlJVc0/ilACfXUVZd3CptM0vo2YL6KD2b78s0bAVklK2xLowDFQzoHbJLBiRTQyI8CxMHHAuIaKR1Ba6DRVgDBeMaBuNOMUxAIjqNlMVJH6yl58YtSxL4/0IvfJPT6QKjDSBeEnR8O/AHYvIkcXHLF6QAAAABJRU5ErkJggg==",b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAtCAYAAAAuj3x7AAABVElEQVRoQ+3aTa7CMAxG0XYHDNn/6hiygyIBg6IqzeefmFa9TF9iJ8fGVNWbJz4lAnNJFpJMQBc1wRDo5flYeuefb/du7qw4vbNU/L17Wc8hsoCy4njukL0H6GzRRrwQtNJxRffYTaOMqdHnBHq08Dc+0EeFPsu4KPLbpGmNKXNHA71fQqCLWhzoIuh1mjU6o2NgAYAeiBvqaH4AfZUxdzTQQPsEinZJHU0Xx6sBdNxQigC0xBRf1IRmXMRxpcc7oIHOFSiKxoweCG1+qcQY8VUDaJ+beZcZep2B7va97P95AlFKBjTQSp8MX6P8O4P04p+O3tZKwWV0JPQ40AmISogh0K3EVxspVlzz6AD6IwC08l1PWPM36ISzv0MceQRFcNNGB9C6gPQcrYfzraSjfW6lu5QiZX39Ixc7REdHLgB0RM+wF2gD1hWWnn50nKVIQBdV6gWjtKguRIE+9gAAAABJRU5ErkJggg==",v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAtCAYAAAAuj3x7AAABIElEQVRoQ+3ZSw6CUBBEUdiBQ/e/OofuAAdOSAymugvKB17H/cHzOg2BeeIXEZgjXWgyAR0agqGhl+djCTlM8+1+qMWhxV0koF1BMR9oEaoTlsStXp+zXoZbHUBXj78ZD3QTbittZNDqX1VWys9WB9DV42zGAw1cU+CdtrVGdlsdV5pQRxpoR6+Qa0EzrQXpVegaXVodQAPdEwhlSRPNFPunAbRvKFUAWmLyg4D2DaUKQEtMfhDQvqFUQYJeV+IJRHL9CAK651bOArpM1ksoQ7NGgO4JhLKY6DNAh67xa5uRn4Ks99Ej4J7lPgF0aFouBR0y27WN9IVl145/Wgzo0MEDDXRIINSGiQY6JBBqw0QDHRIItWGigQ4JhNow0SHoFz6ZeC4X3yntAAAAAElFTkSuQmCC",V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAtCAYAAAAuj3x7AAABJklEQVRoQ+3aQRLCIAyF4XIDl97/dC69QV24YcaiCSQPbH/XSMqXZ9qZWjY+EoEiqUKRDWhRCKZB78/HfnTGcrtPu6ZM82mHAjqzrdXeQAdDt0CDy6RtFzXK0kcH0O8MAP3jt7B0ov89xd45ZGlGSqKB/mwV0N74HqxPSfTV0urtQwvdnWigv9MD7Y1m53qgO+FGvlajMzpGJB3P4ECvBM0NsK8b7tEBNNB9AqJvkWigRQKiMiR6JWhugOPdMCUaaKDHBUQ7kGigRQKiMiQaaJGAqAyJBlokICpjSnTrWni+5p2hKKdAnwt6idM0LiJjrFn+HGMxcb8ztGw6aw3QInmgRdCWMnUzosaCpe6pRoflwEBblALWAB2AuPIWlxsds5oBtEj+BQY1nC5YdIUmAAAAAElFTkSuQmCC";class l{static _lastId=0;id;scene;started=!1;tags=[];x;y;onUpdate;_components=[];constructor(t,e,...i){this.id=l._newId(),this.x=t,this.y=e,this.tags=i}static _newId(){return this._lastId++,this._lastId}add(...t){return t.forEach(e=>{this._components.push(e),e.actor=this}),this}get(t){const e=this._components.find(i=>i instanceof t);return e&&e instanceof t?e:null}update(t){this._components.forEach(e=>e.update(t)),this.onUpdate&&this.onUpdate(t)}destroy(){this.scene?.remove(this)}get game(){return this.scene?.game}}async function d(s){return new Promise(t=>{const e=new Image;e.onload=()=>{t(e)},e.src=s})}async function E(s,t,e){const i=await d(s),n=i.width/t,o=i.height/e,c=[];for(let A=0;A<i.height;A+=o)for(let f=0;f<i.width;f+=n){const x=await createImageBitmap(i,f,A,n,o);c.push(x)}return c}class a{actor;update(t){}get scene(){return this.actor?.scene}get game(){return this.scene?.game}}class R extends a{images;fps;frames;_frameCursor=0;_time=0;constructor(t,e,i){super(),this.images=t,this.frames=e,this.fps=i}update(t){super.update(t),this._time+=t,this._time>this._delayBetweenFrame&&(this._time=0,this._frameCursor=(this._frameCursor+1)%this.frames.length),this.game&&this.actor&&this.game.renderContext.drawImage(this._currentFrame,this.actor.x,this.actor.y)}get _currentFrame(){return this.images[this.frames[this._frameCursor]]}get _delayBetweenFrame(){return 1/this.fps}get width(){return this._currentFrame.width}get height(){return this._currentFrame.height}}class r extends a{width;height;constructor(t){super(),this.width=t.width,this.height=t.height}isColliding(t){if(!this.actor?.get(h)?.solid)return null;const e=this.scene?.getAllByComponent(h);if(e)for(const i of e){const n=this._zoneCollision(t),o=i.get(r);if(i.get(h)?.solid&&i.id!==this.actor?.id&&this._rectCollision(n,o))return o}return null}isOverlapping(t){const e=this.scene?.getAllByTag(t),i=[];return e?.forEach(n=>{if(n.id!==this.actor?.id){const o=n.get(r)?.box;o&&this._rectCollision(this.box,o)&&i.push(n)}}),i.length===0?!1:i}_rectCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.height+t.y>e.y}_zoneCollision(t){switch(t){case"left":return{x:this.box.x-1,y:this.box.y+1,width:1,height:this.box.height-2};case"right":return{x:this.box.x+this.box.width,y:this.box.y+1,width:1,height:this.box.height-2};case"top":return{x:this.box.x,y:this.box.y,width:this.box.width-2,height:1};case"bottom":return{x:this.box.x+1,y:this.box.y+this.box.height,width:this.box.width-2,height:1}}}get box(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get x(){return this.actor?.x??0}get y(){return this.actor?.y??0}get onFloor(){return this.isColliding("bottom")!==null}get onCeil(){return this.isColliding("top")!==null}get onWall(){return this.isColliding("left")!==null||this.isColliding("right")!==null}}class h extends a{velocity={x:0,y:0};maxVelocity;solid=!0;constructor(t){if(super(),t){const{maxVelocity:e,solid:i}=t;e&&(this.maxVelocity=e),this.solid=i??!0}}update(t){this._clampVelocity(t);const e=this.actor?.get(r);if(this.actor){this.actor.x+=this.velocity.x*t;const i=this.xDirection;if(i&&this.solid){const o=e?.isColliding(i);o&&i==="right"&&(this.actor.x=o.x-(e?.width??0)),o&&i==="left"&&(this.actor.x=o.x+o.width)}this.actor.y+=this.velocity.y*t;const n=this.yDirection;if(n&&this.solid){const o=e?.isColliding(n)??0;o&&n==="top"&&(this.actor.y=o.y+o.height),o&&n==="bottom"&&(this.actor.y=o.y-(e?.height??0))}}}_clampVelocity(t){const e=Math.sqrt(this.velocity.x**2+this.velocity.y**2);if(this.maxVelocity&&e>this.maxVelocity){const i=this.maxVelocity/e*t;this.velocity.x=this.velocity.x*i,this.velocity.y=this.velocity.y*i}}get xDirection(){return this.velocity.x>0?"right":this.velocity.x<0?"left":null}get yDirection(){return this.velocity.y>0?"bottom":this.velocity.y<0?"top":null}}class F extends a{gravity;constructor(t){super(),this.gravity=t}update(){const t=this.actor?.get(h),e=this.actor?.get(r);t&&(t.velocity.y+=this.gravity,e?.onFloor&&(t.velocity.y=Math.min(t.velocity.y,0)))}}class Q extends a{_lastJumpRequest=0;_lastTimeOnFloor=0;jumpTimeTolerence=-1/0;velocity;constructor(t,e){super(),this.velocity=t,this.jumpTimeTolerence=e??this.jumpTimeTolerence}update(){const t=this.actor?.get(r),e=window.performance.now();t?.onFloor&&(this._lastTimeOnFloor=e,e-this._lastJumpRequest<this.jumpTimeTolerence&&this._jump())}jump(){const t=this.actor?.get(r),e=this.actor?.get(h),i=window.performance.now();t?.onFloor?this._jump():i-this._lastTimeOnFloor<this.jumpTimeTolerence&&e?.yDirection==="bottom"?this._jump():this._lastJumpRequest=window.performance.now()}_jump(){const t=this.actor?.get(h);t&&(t.velocity.y=-this.velocity)}}class I extends a{width;height;color;constructor(t,e,i){super(),this.width=t,this.height=e,this.color=i}update(t){if(super.update(t),this.game&&this.actor){const e=this.game.renderContext;e.fillStyle=this.color,e.fillRect(this.actor.x,this.actor.y,this.width,this.height)}}}class w extends a{image;constructor(t){super(),this.image=t}update(t){super.update(t),this.game&&this.actor&&this.game.renderContext.drawImage(this.image,this.actor.x,this.actor.y)}get width(){return this.image.width}get height(){return this.image.height}}let m=!1;function X(){document.addEventListener("mousedown",()=>m=!0),document.addEventListener("mouseup",()=>m=!1)}function P(){return m}class U{canvas;ctx;constructor(t,e){this.canvas=this._createCanvas(t,e),this.ctx=this.canvas.getContext("2d")}_createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,document.body.appendChild(i),i}}class D{_lastTime;updateFunction;constructor(t){this.updateFunction=t}start(){requestAnimationFrame(this._loop.bind(this))}_loop(t){if(requestAnimationFrame(this._loop.bind(this)),this._lastTime){const e=(t-this._lastTime)/1e3;this.updateFunction(e)}this._lastTime=t}}class H{_drawing;_loop;_scene;constructor(t,e){this._drawing=new U(t,e),this._loop=new D(this.update.bind(this))}start(){X(),this._loop.start()}update(t){this.renderContext.clearRect(0,0,this.width,this.height),this._scene?.update(t)}get width(){return this._drawing.canvas.width}get height(){return this._drawing.canvas.height}get renderContext(){return this._drawing.ctx}set scene(t){this._scene=t,this._scene.game=this}}class M{_actors=[];game;started=!1;onUpdate;update(t){this._actors.forEach(e=>e.update(t)),this.onUpdate&&this.onUpdate(t)}add(...t){return t.forEach(e=>{this._actors.push(e),e.scene=this}),this}getAllByComponent(t){return this._actors.filter(e=>e.get(t)!==null)}getAllByTag(t){return this._actors.filter(e=>e.tags.includes(t))}remove(...t){const e=t.map(i=>i.id);return this._actors=this._actors.filter(i=>!e.includes(i.id)),this}}function u(s,t){return Math.floor(Math.random()*(t+1))+s}function j(s){const t=u(0,s.length-1);return s[t]}const z=await E(B,2,2),T=await d(C),O=[await d(b),await d(v),await d(V)],g=new H(800,600);g.scene=y();g.start();function y(){let s=0,t=2;const e=new M;for(let i=0;i<=g.width;i+=50)e.add(p(i));return e.onUpdate=i=>{s+=i,s>t&&(s=0,e.add(q()),t=u(1,2.2))},e.add(L(),N())}function L(){const s=new l(50,50,"player"),t=new R(z,[0,1,2,3],5),e=new r(t),i=new h,n=new F(15),o=new Q(400);return s.onUpdate=()=>{P()&&o.jump()},s.add(t,e,i,n,o)}function N(){const s=new l(0,500),t=new I(800,300,"black"),e=new r(t),i=new h;return s.add(t,e,i)}function q(){const s=new l(800,475),t=new w(T),e=new r(t),i=new h({solid:!1});return i.velocity.x=-230,s.add(t,i,e),s.onUpdate=()=>{s.x<-t.width&&s.destroy(),e.isOverlapping("player")&&(g.scene=y())},s}function p(s){const t=s?u(s-100,s+100):600,e=new l(t,u(10,50),"ennemie"),i=j(O),n=new w(i),o=new r(n),c=new h({solid:!1});return c.velocity.x=-50,e.add(n,c,o),e.onUpdate=()=>{e.x<-n.width&&(e.scene?.add(p(g.width)),e.destroy())},e}
